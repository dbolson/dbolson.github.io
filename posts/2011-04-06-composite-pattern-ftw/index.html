<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Composite Pattern FTW - Rubber Duck Dialogs</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Rubber Duck Dialogs" rel=home><div class="logo__item logo__text"><div class=logo__title>Rubber Duck Dialogs</div></div></a></div><div class=divider></div></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Composite Pattern FTW</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2011-04-06T00:00:00Z>April 06, 2011</time></div></div></header><div class="content post__content clearfix"><p>A <a href=http://www.paulgraham.com/taste.html>post</a> by Paul Graham I recently found resonated with what I&rsquo;ve been doing at work recently. In his post, &ldquo;Taste for Makers,&rdquo; PG posits that beauty is not wholly subjective and that good design is beautiful. Among others, good design:</p><ul><li>is simple</li><li>solves the right problem</li><li>is suggestive</li><li>looks easy</li><li>uses symmetry</li><li>is redesign</li><li>can copy</li><li>is often quite strange</li><li>happens in chunks</li></ul><p>I&rsquo;d like to focus on a few of these descriptions and use an example I&rsquo;ve recently done.</p><p>In his fantastic book, <em><a href=http://www.designpatternsinruby.com/>Design Patterns in Ruby</a></em>, <a href=http://blog.russolsen.com/>Russ Olsen</a> describes one tenant of the <a href=http://c2.com/cgi/wiki?GangOfFour>GOF</a> book to “prefer composition over inheritance.” Inheritance creates tighter coupling between classes, since the children of the base class need to know about the internals of the base, even though the coupling is very specific to the implementation and (should be) well understood. <a href=http://en.wikipedia.org/wiki/Composite_pattern>Composition</a>, however, changes the relationship between objects. An object no longer is another type of object but has the functionality of another object (<a href=http://en.wikipedia.org/wiki/Has-a>is-a vs. has-a</a>). This relationship increases the encapsulation of the composite object by providing an interface to the composed object instead of exposing the underlying details of a base class.</p><h3 id=slices-and-dices>Slices <em>and</em> Dices!</h3><p>Now I know there is a tendency to think of design patterns as a <a href=http://en.wikipedia.org/wiki/No_Silver_Bullet>silver bullet</a>, but bear with me. The situation is fine when the inheritance tree is simple and the functionality basic. The complexity grows as the tree grows and as more functionality is required. Soon, you&rsquo;re not quite sure if it should inherit <code>Foo</code> which inherits from <code>Bar</code>, or if you should just inherit from Baz way up near the base. You&rsquo;ll have to dig into the classes to find out which one is closest to what you want and hope it makes the most sense to place the new class wherever you end up placing it. However, using the Composite Pattern gives us much more flexibility for creating new classes and giving them abilities.</p><h3 id=an-example>An Example</h3><p>There is a system that asks users different types of questions. One type asks when an event will happen (<code>DateQuestion</code>), one type asks the numerical results of an event (<code>NumberQuestion</code>), and one asks which event will happen given a set of choices (<code>ChoiceQuestion</code>). We have a base <code>Question</code> that each inherits from, and since dates can be represented as numbers, <code>DateQuestion</code> will inherit from <code>NumberQuestion</code>. These questions allow answers, comments, access control lists, and have a specific work flow (create, activate, suspend, close, etc.).</p><p>Later on, the system needs to support a few more types of questions: a numeric range (<code>NumberRangeQuestion</code>), a date range (<code>DateRangeQuestion</code>), a yes/no-only (<code>YesNoQuestion</code>)&mldr; you get the point. We need to figure out where these new types go in the inheritance tree – whether one is a child of a <code>DateQuestion</code> (itself a child of <code>NumberQuestion</code>), or if it&rsquo;s just a child of <code>NumberQuestion</code>, or maybe it&rsquo;s its own type and only inherits from the base <code>Question</code> type. We start to bump into complexity issues, that is, unnecessary complexity.</p><h3 id=ill-take-a-little-of-this>I&rsquo;ll Take a Little of This&mldr;</h3><p>Let&rsquo;s approach this problem from a different angle. Given our original <code>Question</code> types, we can make them all inherit from a base <code>Question</code> class and then give them abilities as needed. So now our classes look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Question</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Commentable</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>AccessListControllable</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Workflowable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NumberQuestion</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Question</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Numerical</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DateQuestion</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Question</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Numerical</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Dateable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChoiceQuestion</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Question</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>include</span> <span style=color:#66d9ef>Choiceable</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p><code>NumberQuestion</code> and <code>DateQuestion</code> are numerical, that is, they have whatever functionality they need to do what numerical objects need to do. The <code>DateQuestion</code> is also dateable, so it has additional properties needed for a dateable object, while <code>NumberQuestion</code>, not needing them, doesn&rsquo;t have those abilities. So when we need additional <code>Question</code> types, we can choose which abilities they need. A <code>DateRangeQuestion</code>? It&rsquo;s dateable, numerical, and it&rsquo;s got its own class-specific functionality as well.</p><p>There are some trade-offs. Some modules may not have all the functionality an object needs, and there is a potential for similar code needed to provide slightly different abilities. There can also be unneeded functionality in a module that an object will never need. These problems aren&rsquo;t specific to the Composite design pattern, as they can occur with regular inheritance as well.</p><h3 id=some-clarity>Some Clarity</h3><p>We&rsquo;ve refactored our code to use a design pattern to organize our code a little better to make our application more maintainable and extendable, both good things, and the process was relatively painless. Since the functionality never changed, just the organization, if the <a href=http://smartic.us/2008/08/15/tatft-i-feel-a-revolution-coming-on/>tests</a> pass, we can feel confident that our models still work how we want.</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2022 Rubber Duck Dialogs.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>